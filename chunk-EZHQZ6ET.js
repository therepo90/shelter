import{a as Y}from"./chunk-LEOWQQUF.js";import{a as q,b as y,c as J,f as Q}from"./chunk-XGG7KTVH.js";import{$a as V,Aa as F,Ba as j,C as _,F as d,G as r,H as o,I as x,J as P,K as S,M as k,N as b,O as f,V as T,W as c,X as h,Za as w,_a as $,ab as R,bb as A,ca as z,d as M,fa as D,fb as N,ga as L,gb as U,ha as B,hb as W,ib as X,ja as v,k as u,lb as G,mb as H,n as E,nb as K,o as O,qb as Z,u as s,y as C}from"./chunk-KRDZAR6Z.js";import"./chunk-VQJLRZDC.js";import"./chunk-JBCXF56H.js";import"./chunk-QUJFQN2Y.js";import"./chunk-6HU4TFNA.js";import"./chunk-SROQCUWQ.js";import"./chunk-TX4Q6HNZ.js";import"./chunk-2J4NCJOL.js";import"./chunk-LBCXAYCZ.js";import"./chunk-5UYKJVW7.js";import"./chunk-J7EDNWVB.js";import"./chunk-BMJVVMK5.js";import"./chunk-NHGX5HSY.js";import"./chunk-I3JQUJOC.js";import"./chunk-7LKXLI3U.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BZSE2QSZ.js";import"./chunk-CKP3SGE2.js";import"./chunk-DW55EUKJ.js";import"./chunk-JNSPDWUV.js";import"./chunk-HNZXAMTE.js";import"./chunk-SCQXEI7G.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-H3Z6NBHK.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g}from"./chunk-2R6CW7ES.js";var ee=(()=>{let n=class n{constructor(){this.modalCtrl=u(y)}cancel(){this.modalCtrl.dismiss(null,"cancel")}confirm(){this.modalCtrl.dismiss(null,"confirm")}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["app-confirm-walk-modal"]],inputs:{dog:"dog",dogName:"dogName"},decls:7,vars:1,consts:[[1,"confirm-modal-wrapper"],[1,"confirm-modal-dogname"],["expand","block","color","success",1,"big-confirm-btn",3,"click"],["expand","block","color","danger",1,"big-cancel-btn",3,"click"]],template:function(i,l){i&1&&(r(0,"div",0)(1,"div",1),c(2),o(),r(3,"ion-button",2),b("click",function(){return l.confirm()}),c(4,"Potwierd\u017A"),o(),r(5,"ion-button",3),b("click",function(){return l.cancel()}),c(6,"Anuluj"),o()()),i&2&&(s(2),h(l.dogName))},dependencies:[v,w],styles:[".confirm-modal-wrapper[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:1.5rem;box-shadow:0 2px 16px #0000002e;padding:1.2rem 2.2rem 1.5rem;display:flex;flex-direction:column;align-items:center;min-width:220px;max-width:90vw;z-index:1000}.confirm-modal-dogname[_ngcontent-%COMP%]{font-size:2.1rem;font-weight:700;margin-bottom:2.2rem;color:#222;text-align:center}.big-confirm-btn[_ngcontent-%COMP%], .big-cancel-btn[_ngcontent-%COMP%]{font-size:2.1rem;min-height:4.2rem;border-radius:2.2rem;margin:.7rem 0;width:100%;font-weight:700}.big-confirm-btn[_ngcontent-%COMP%]{margin-bottom:2.2rem}.big-cancel-btn[_ngcontent-%COMP%]{font-size:2.3rem;margin-top:2rem}"]});let t=n;return t})();var ne=(t,n)=>({"green-btn":t,"red-btn":n});function ie(t,n){t&1&&(r(0,"h2",16),c(1,"LIVE"),o())}function oe(t,n){t&1&&(r(0,"h2",16),c(1,"Testing"),o())}function re(t,n){t&1&&x(0,"ion-spinner",17)}function ae(t,n){if(t&1&&(r(0,"ion-text",18),c(1),o()),t&2){let a=f();s(),h(a.loadError)}}function se(t,n){if(t&1){let a=k();P(0),r(1,"ion-button",24),b("click",function(){let i=E(a).$implicit,l=f().$implicit,p=f(2);return O(p.onDogClick(l,i))}),c(2),o(),S()}if(t&2){let a=n.$implicit,e=f().$implicit;s(),d("ngClass",z(3,ne,e.status,!e.status))("disabled",e.status==="X"||e.status==="x"||(e.status||"").toLowerCase().slice(0,1).includes(a.toLowerCase().slice(0,1))),s(),h(a)}}function le(t,n){if(t&1&&(P(0),r(1,"div",26)(2,"div",27)(3,"div"),c(4),o()(),r(5,"span",28),c(6),o()(),S()),t&2){let a=n.$implicit,e=f(4);s(2),T("background",a.value?"#2dd36f":"#eb445a"),s(2),h(a.value),s(2),h(e.getShortDate(a.date))}}function ce(t,n){if(t&1&&(r(0,"div",25),_(1,le,7,4,"ng-container",21),o()),t&2){let a=f().$implicit;s(),d("ngForOf",a.recentPresence)}}function me(t,n){if(t&1&&(r(0,"tr")(1,"td"),c(2),o(),r(3,"td")(4,"div",22),_(5,se,3,6,"ng-container",21),o(),_(6,ce,2,1,"div",23),o()()),t&2){let a=n.$implicit,e=f(2);s(2),h(a.box),s(3),d("ngForOf",e.splitDogNames(a.name)),s(),d("ngIf",a.recentPresence)}}function de(t,n){if(t&1&&(r(0,"div",19)(1,"table",20)(2,"thead")(3,"tr")(4,"th"),c(5,"BOX"),o(),r(6,"th"),c(7,"IMI\u0118"),o()()(),r(8,"tbody"),_(9,me,7,3,"tr",21),o()()()),t&2){let a=f();s(9),d("ngForOf",a.dogs)}}function pe(t,n){console.log({dogFull:t.name,dogName:n,status:t.status});let a=t.name.split(",").map(m=>m.trim().toLowerCase()).filter(m=>m.length>0);console.log({allDogsInBox:a});let e=t.status?t.status.toUpperCase().split(""):[],i=n.toUpperCase().slice(0,1);return e.includes(i)||e.push(i),console.log({currentStatus:e}),a.map(m=>m.slice(0,1).toUpperCase()).every(m=>e.includes(m))?"X":e.join("")}var ze=(()=>{let n=class n{constructor(){this.dogs=[],this.selectedDogs=[],this.isLoading=!1,this.loadError=null,this.markError=null,this.dogsService=u(Q),this.loadingCtrl=u(q),this.toastCtrl=u(J),this.modalCtrl=u(y),this.live=void 0,this.platform=u(j),this.onVisibilityChange=()=>{console.log("Visibility changed:",document.visibilityState),document.visibilityState==="visible"&&this.loadDogs()}}ngOnInit(){return g(this,null,function*(){yield this.loadDogs(),this.isLive().subscribe(e=>{this.live=e}),this.platform.ready().then(()=>{this.resumeSubscription=this.platform.resume.subscribe(()=>{console.log("App resumed"),this.loadDogs()})}),document.addEventListener("visibilitychange",this.onVisibilityChange)})}ngOnDestroy(){this.resumeSubscription&&this.resumeSubscription.unsubscribe(),document.removeEventListener("visibilitychange",this.onVisibilityChange)}ionViewWillEnter(){return g(this,null,function*(){yield this.loadDogs()})}loadDogs(){return g(this,null,function*(){this.isLoading=!0,this.loadError=null;try{this.dogsService.getAllDogs().subscribe({next:e=>g(this,null,function*(){let i=yield this.dogsService.getSelectedBoxes();this.dogs=Y(e.filter(l=>i.some(p=>p.box===l.box))),this.isLoading=!1}),error:()=>{this.loadError="B\u0142\u0105d wczytywania piesk\xF3w",this.isLoading=!1}})}catch{this.loadError="B\u0142\u0105d wczytywania piesk\xF3w",this.isLoading=!1}})}onDogClick(e,i){return g(this,null,function*(){let l=yield this.modalCtrl.create({component:ee,componentProps:{dog:e,dogName:i},showBackdrop:!0});yield l.present();let{role:p}=yield l.onDidDismiss();if(p!=="confirm")return;this.markError=null;let m=yield this.loadingCtrl.create({message:`Zapisuj\u0119 spacer dla: ${i}`});yield m.present(),this.dogsService.sendDogClick(e,i).subscribe({next:()=>g(this,null,function*(){yield m.dismiss();let I=pe(e,i);e.status=I,e.recentPresence&&e.recentPresence.length&&(e.recentPresence[e.recentPresence.length-1].value=e.status),(yield this.toastCtrl.create({message:`Spacer zapisany dla: ${i}`,duration:1200,color:"success"})).present()}),error:()=>g(this,null,function*(){yield m.dismiss(),this.markError=`B\u0142\u0105d zapisywania spaceru dla: ${i}`,(yield this.toastCtrl.create({message:`B\u0142\u0105d zapisywania spaceru dla: ${i}`,duration:2e3,color:"danger"})).present()})})})}doRefresh(e){return g(this,null,function*(){yield this.loadDogs(),e.target.complete()})}isLive(){return this.dogsService.getCfg().pipe(M(e=>e.live))}getShortDate(e){return e.split("/").slice(0,2).join("/")}splitDogNames(e){return e.split(",").map(i=>i.trim()).filter(i=>i.length>0)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["app-tab1"]],decls:32,vars:7,consts:[[3,"translucent"],["class","live",4,"ngIf"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"ion-padding-top","ion-padding-start"],[1,"ion-align-items-center"],["size","auto",1,""],["name","ellipse","color","danger"],["size","4",1,"ion-no-padding"],["name","ellipse","color","success"],["size","12"],["collapse","condense"],["size","large"],["name","crescent","class","ion-margin",4,"ngIf"],["color","danger",4,"ngIf"],["class","dogs-table-wrapper",4,"ngIf"],[1,"live"],["name","crescent",1,"ion-margin"],["color","danger"],[1,"dogs-table-wrapper"],[1,"dogs-table"],[4,"ngFor","ngForOf"],[1,"dog-names-row"],["style","display:flex; gap:4px; margin-top:4px;justify-content:space-between;",4,"ngIf"],[1,"dog-name-btn",3,"click","ngClass","disabled"],[2,"display","flex","gap","4px","margin-top","4px","justify-content","space-between"],[2,"display","flex","flex-direction","column","align-items","center"],[1,"pres-val"],[2,"font-size","0.9em","color","#888"]],template:function(i,l){i&1&&(r(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),c(3," Spacery "),_(4,ie,2,0,"h2",1)(5,oe,2,0,"h2",1),o()()(),r(6,"ion-content",2)(7,"ion-refresher",3),b("ionRefresh",function(m){return l.doRefresh(m)}),x(8,"ion-refresher-content"),o(),r(9,"ion-grid",4)(10,"ion-row",5)(11,"ion-col",6),x(12,"ion-icon",7),o(),r(13,"ion-col",8),c(14,"nie by\u0142"),o()(),r(15,"ion-row",5)(16,"ion-col",6),x(17,"ion-icon",9),o(),r(18,"ion-col",8),c(19,"by\u0142"),o()(),r(20,"ion-row")(21,"ion-col",10)(22,"small")(23,"i"),c(24,"Kliknij w imi\u0119 psa, aby zaznaczy\u0107 spacer"),o()()()()(),r(25,"ion-header",11)(26,"ion-toolbar")(27,"ion-title",12),c(28,"Spacery"),o()()(),_(29,re,1,0,"ion-spinner",13)(30,ae,2,1,"ion-text",14)(31,de,10,1,"div",15),o()),i&2&&(d("translucent",!0),s(4),d("ngIf",l.live),s(),d("ngIf",!l.live),s(),d("fullscreen",!0),s(23),d("ngIf",l.isLoading),s(),d("ngIf",l.loadError),s(),d("ngIf",!l.isLoading&&!l.loadError))},dependencies:[v,D,L,B,F,A,K,G,w,Z,H,V,R,W,$,X,N,U],styles:['@charset "UTF-8";.dogs-table-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}.dogs-table[_ngcontent-%COMP%]{width:100%;max-width:500px;border-collapse:separate;border-spacing:0 1rem}.dogs-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .dogs-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;padding:.5rem 1rem}.dog-names-row[_ngcontent-%COMP%]{display:flex;width:100%;gap:6px}.dog-name-btn[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;font-size:1.3rem;border-radius:2rem;font-weight:700;margin:.2rem 0;min-height:5.5rem;padding-top:1.5rem;padding-bottom:1.5rem}.dog-name-btn.disabled[_ngcontent-%COMP%]{opacity:1}.red-btn[_ngcontent-%COMP%]{--background: #e53935;--color: #fff}.green-btn[_ngcontent-%COMP%]{--background: #43a047;--color: #fff}@media (max-width: 600px){.dogs-table[_ngcontent-%COMP%]{font-size:.95rem;max-width:100%}.dog-name-btn[_ngcontent-%COMP%]{font-size:1rem;min-height:4rem;padding-top:1.1rem;padding-bottom:1.1rem;max-width:100%;overflow:hidden;text-overflow:ellipsis;flex:1 1 0;min-width:0}}.legend-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:.7rem auto .2rem;font-size:.93rem;background:#fff;border-radius:1.2rem;box-shadow:0 2px 8px #00000012;padding:.5rem 1.2rem .7rem;min-width:120px;max-width:220px}.legend-title[_ngcontent-%COMP%]{font-size:.92em;color:#888;font-weight:500;margin-bottom:.2em;letter-spacing:.03em;text-align:center}.legend-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.18em;margin-bottom:.2em;align-items:center}.legend-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.1em}.legend-dot[_ngcontent-%COMP%]{display:inline-block;width:1em;height:1em;border-radius:50%;margin-right:.35em;vertical-align:middle;border:1.5px solid #eee}.red-dot[_ngcontent-%COMP%]{background:#e53935}.green-dot[_ngcontent-%COMP%]{background:#43a047}.legend-label[_ngcontent-%COMP%]{color:#444;font-size:.97em}.legend-instruction[_ngcontent-%COMP%]{width:100%;text-align:center;color:#aaa;font-size:.87em;font-style:italic;margin-top:.2em;margin-bottom:.2em}.live[_ngcontent-%COMP%]{color:gray;font-size:.6rem;display:inline-block}.pres-val[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:28px;height:28px;border-radius:3px;margin-bottom:2px}']});let t=n;return t})();export{ze as Tab1Page,pe as calcNewStatus};
