import{f as oe,h as re}from"./chunk-RS2UFXYS.js";import{d as ee,f as te}from"./chunk-XGG7KTVH.js";import{Ba as X,C as T,F as M,G as L,H as K,I as N,Ta as Y,Ua as G,Va as J,Wa as V,Xa as q,Ya as Q,ha as z,ja as D,k,ka as O,l as b,ma as F,na as H,pa as $,pb as Z,ra as W,sa as j,ta as B,y as U}from"./chunk-KRDZAR6Z.js";import"./chunk-EGBFUY26.js";import{a as y}from"./chunk-VQJLRZDC.js";import"./chunk-JBCXF56H.js";import"./chunk-QUJFQN2Y.js";import"./chunk-6HU4TFNA.js";import"./chunk-SROQCUWQ.js";import"./chunk-TX4Q6HNZ.js";import"./chunk-2J4NCJOL.js";import"./chunk-LBCXAYCZ.js";import"./chunk-5UYKJVW7.js";import"./chunk-J7EDNWVB.js";import"./chunk-BMJVVMK5.js";import"./chunk-NHGX5HSY.js";import"./chunk-I3JQUJOC.js";import"./chunk-7LKXLI3U.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BZSE2QSZ.js";import"./chunk-CKP3SGE2.js";import"./chunk-DW55EUKJ.js";import"./chunk-JNSPDWUV.js";import"./chunk-HNZXAMTE.js";import"./chunk-SCQXEI7G.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-H3Z6NBHK.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as I}from"./chunk-2R6CW7ES.js";var ne=[{path:"",loadChildren:()=>import("./chunk-ZMJNVMQ5.js").then(i=>i.routes)}];var _=y("SplashScreen",{web:()=>import("./chunk-M7UFVKZR.js").then(i=>new i.SplashScreenWeb)});var le="__capgo_keep_url_path_after_reload",E="__capgo_history_stack__";var fe=typeof window<"u"&&typeof document<"u"&&typeof history<"u";if(fe){let i=window;if(!i.__capgoHistoryPatched){i.__capgoHistoryPatched=!0;let p=()=>{try{if(i.__capgoKeepUrlPathAfterReload)return!0}catch{}try{return window.localStorage.getItem(le)==="1"}catch{return!1}},m=()=>{try{let e=window.sessionStorage.getItem(E);if(!e)return{stack:[],index:-1};let t=JSON.parse(e);return!t||!Array.isArray(t.stack)||typeof t.index!="number"?{stack:[],index:-1}:t}catch{return{stack:[],index:-1}}},c=(e,t)=>{try{window.sessionStorage.setItem(E,JSON.stringify({stack:e,index:t}))}catch{}},a=()=>{try{window.sessionStorage.removeItem(E)}catch{}},s=e=>{try{let t=e??window.location.href,r=new URL(t instanceof URL?t.toString():t,window.location.href);return`${r.pathname}${r.search}${r.hash}`}catch{return null}},u=(e,t)=>{if(e.length<=100)return{stack:e,index:t};let r=e.length-100,o=e.slice(r),n=Math.max(0,t-r);return{stack:o,index:n}},se=e=>{document.readyState==="complete"||document.readyState==="interactive"?e():window.addEventListener("DOMContentLoaded",e,{once:!0})},d=!1,h=!1,v=!1,S=()=>{if(!d)return;let e=m(),t=s();if(t){if(e.stack.length===0){e.stack.push(t),e.index=0,c(e.stack,e.index);return}(e.index<0||e.index>=e.stack.length)&&(e.index=e.stack.length-1),e.stack[e.index]!==t&&(e.stack[e.index]=t,c(e.stack,e.index))}},C=(e,t)=>{if(!d||h)return;let r=s(e);if(!r)return;let{stack:o,index:n}=m();o.length===0?(o.push(r),n=o.length-1):t?((n<0||n>=o.length)&&(n=o.length-1),o[n]=r):n>=o.length-1?(o.push(r),n=o.length-1):(o=o.slice(0,n+1),o.push(r),n=o.length-1),{stack:o,index:n}=u(o,n),c(o,n)},ce=()=>{if(!d||h)return;let e=m();if(e.stack.length===0){S();return}let t=e.index>=0&&e.index<e.stack.length?e.index:e.stack.length-1,r=s();if(e.stack.length===1&&r===e.stack[0])return;let o=e.stack[0];if(!o)return;h=!0;try{history.replaceState(history.state,document.title,o);for(let g=1;g<e.stack.length;g+=1)history.pushState(history.state,document.title,e.stack[g])}catch{h=!1;return}h=!1;let n=e.stack.length-1,R=t-n;R!==0?history.go(R):(history.replaceState(history.state,document.title,e.stack[t]),window.dispatchEvent(new PopStateEvent("popstate")))},A=()=>{!d||v||(v=!0,se(()=>{v=!1,ce()}))},l=null,f=null,P=()=>{if(!d||h)return;let e=s();if(!e)return;let t=m(),r=t.stack.lastIndexOf(e);r>=0?t.index=r:(t.stack.push(e),t.index=t.stack.length-1);let o=u(t.stack,t.index);c(o.stack,o.index)},pe=()=>{l&&f||(l=history.pushState,f=history.replaceState,history.pushState=function(t,r,o){let n=l?.call(history,t,r,o);return C(o,!1),n},history.replaceState=function(t,r,o){let n=f?.call(history,t,r,o);return C(o,!0),n},window.addEventListener("popstate",P))},de=()=>{l&&(history.pushState=l,l=null),f&&(history.replaceState=f,f=null),window.removeEventListener("popstate",P)},x=e=>{if(d===e){d&&(S(),A());return}d=e,d?(pe(),S(),A()):(de(),a())};window.addEventListener("CapacitorUpdaterKeepUrlPathAfterReload",e=>{var t;let r=e,o=(t=r?.detail)===null||t===void 0?void 0:t.enabled;typeof o=="boolean"?(i.__capgoKeepUrlPathAfterReload=o,x(o)):(i.__capgoKeepUrlPathAfterReload=!0,x(!0))}),x(p())}}var w=y("CapacitorUpdater",{web:()=>import("./chunk-MHLSCMLO.js").then(i=>new i.CapacitorUpdaterWeb)});function he(i,p){i&1&&(L(0,"ion-app"),N(1,"ion-router-outlet"),K())}var ie=(()=>{let p=class p{constructor(){this.initialized=!1,this.platform=k(X),this.dogsService=k(te),w.notifyAppReady(),this.platform.ready().then(()=>{this.platform.is("hybrid")?this.checkForUpdate():this.initialized=!0})}checkForUpdate(){return I(this,null,function*(){try{console.log("Checking for updates...");let c=yield fetch("https://raw.githubusercontent.com/therepo90/shelter/refs/heads/main/.git-version");if(!c.ok)throw new Error("Failed to fetch version info");let a=(yield c.text()).trim(),s=yield this.dogsService.getVersion();if(console.log({version:a,localVersion:s}),a&&s&&a!==s){console.log(`Updating from version ${s} to ${a}`),alert(`Updating app to version ${a}. Please wait...`),_.show();let u=yield w.download({url:"https://raw.githubusercontent.com/therepo90/shelter/refs/heads/main/releases/www.zip",version:a});yield w.set({id:u.id}),alert("Reloading app"),window.location.reload()}else console.log(a&&!s?`Setting initial version to ${a}`:`App is up to date with version ${s}`)}catch(c){console.error("Update check failed",c),alert("Update check error: "+c)}finally{_.hide(),this.initialized=!0}})}};p.\u0275fac=function(a){return new(a||p)},p.\u0275cmp=U({type:p,selectors:[["app-root"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(a,s){a&1&&T(0,he,2,0,"ion-app",0),a&2&&M("ngIf",s.initialized)},dependencies:[D,z,Q,q],encapsulation:2});let i=p;return i})();var me=()=>re(),ae=(i,p)=>typeof window>"u"?Promise.resolve():me().then(()=>oe([["pwa-camera-modal",[[1,"pwa-camera-modal",{facingMode:[1,"facing-mode"],hidePicker:[4,"hide-picker"],present:[64],dismiss:[64]}]]],["pwa-action-sheet",[[1,"pwa-action-sheet",{header:[1],cancelable:[4],options:[16],open:[32]}]]],["pwa-toast",[[1,"pwa-toast",{message:[1],duration:[2],closing:[32]}]]],["pwa-camera",[[1,"pwa-camera",{facingMode:[1,"facing-mode"],handlePhoto:[16],hidePicker:[4,"hide-picker"],handleNoDeviceError:[16],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"],photo:[32],photoSrc:[32],showShutterOverlay:[32],flashIndex:[32],hasCamera:[32],rotation:[32],deviceError:[32]}]]],["pwa-camera-modal-instance",[[1,"pwa-camera-modal-instance",{facingMode:[1,"facing-mode"],hidePicker:[4,"hide-picker"],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"]},[[16,"keyup","handleBackdropKeyUp"]]]]]],p));ae(window);J();V();G();O(ie,{providers:[F(H()),{provide:$,useClass:Y},Z(),j(ne,B(W)),b(ee.forRoot({}))]});
